<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>TAP - Gorkem Ozlu - Yet Another Cloud Native Blog</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="TAP"><meta property="og:description" content="Yet Another Cloud Native Blog"><meta property="og:type" content="website"><meta property="og:url" content="https://gorkemozlu.com/tags/tap/"><meta name=twitter:card content="summary"><meta name=twitter:title content="TAP"><meta name=twitter:description content="Yet Another Cloud Native Blog"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel=alternate type=application/rss+xml href=/tags/tap/index.xml title="Gorkem Ozlu - Yet Another Cloud Native Blog"><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class="logo logo--mixed"><a class=logo__link href=/ title="Gorkem Ozlu" rel=home><div class="logo__item logo__imagebox"><img class=logo__img src=/img/1597427326741.jpeg></div><div class="logo__item logo__text"><div class=logo__title>Gorkem Ozlu</div><div class=logo__tagline>Yet Another Cloud Native Blog</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>About</span></a></li><li class=menu__item><a class=menu__link href=/disclaimer/><span class=menu__text>Disclaimer</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class="main list" role=main><header class=main__header><h1 class=main__title>TAP</h1></header><article class="list__item post"><figure class="list__thumbnail thumbnail"><a class=thumbnail__link href=/post/nodejs-on-tap/><img class=thumbnail__image src=/img/nodejs-on-tap/19-tap-gui-02.png alt="Developing and Deploying NodeJS with Data Services on TAP"></a></figure><header class=list__header><h2 class="list__title post__title"><a href=/post/nodejs-on-tap/ rel=bookmark>Developing and Deploying NodeJS with Data Services on TAP</a></h2><div class="list__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2022-12-10T00:00:00Z>2022-12-10</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/development/ rel=category>development</a>, <a class=meta__link href=/categories/tap/ rel=category>TAP</a>, <a class=meta__link href=/categories/nodejs/ rel=category>NodeJS</a>, <a class=meta__link href=/categories/data/ rel=category>Data</a></span></div></div></header><div class="content list__excerpt post__content clearfix"><p>On this post, we&rsquo;ll go through a high level experience with a NodeJS app on Tanzu Application Platform. We&rsquo;re going to cover attaching Data Services on top of NodeJS app as well.</p></div><div class="list__footer clearfix"><a class="list__footer-readmore btn" href=/post/nodejs-on-tap/>Read more…</a></div></article></main></div><aside class=sidebar><form id=search action=https://gorkemozlu.com/search/ method=get><label hidden for=search-input>Search site</label>
<input type=text id=search-input name=query placeholder="Type here to search">
<input type=submit value=search></form><script>window.store={"https://gorkemozlu.com/post/nodejs-on-tap/":{title:"Developing and Deploying NodeJS with Data Services on TAP",tags:["development","TAP","NodeJS","Data","Redis","MongoDB","PostgreSQL","MySQL"],content:`On this post, we\u0026rsquo;ll go through a high level experience with a NodeJS app on Tanzu Application Platform. We\u0026rsquo;re going to cover attaching Data Services on top of NodeJS app as well.
Tanzu Application Platform is a platform for building and running modern applications. It is built on top of Kubernetes and provides a range of tools and services for building, deploying, and managing applications. It allows developers to focus on writing code, while the platform handles the underlying infrastructure and support for scaling and rolling out applications. It also provides a variety of services and integrations for building and deploying applications, such as databases, messaging systems, and other common building blocks for modern applications.
This NodeJS application has multiple capabilities like:
Show Kubernetes Node, pod, serviceaccount name, namespace etc. on main page. Create a file on PVC, add content and do backup\u0026amp;restore operations with Velero Have built-in interaction with stateful applications like: Redis MongoDB MySQL PostgreSQL Before we start, you can find all the post content and more on my git repo: https://github.com/gorkemozlu/sample-nodejs-app
As a developer, i\u0026rsquo;ll go through my application catalog and choose my project which is \u0026ldquo;Sample NodeJS App with Data Bindings\u0026rdquo;
Then it will ask me several options.
For example, my dev namespace is \u0026ldquo;my-apps\u0026rdquo; and i would like to use existing \u0026ldquo;Dockerfile\u0026rdquo; to build my application.
It will ask for you to choose the git repo and branch name to pull the source code.
Then, i\u0026rsquo;ll choose App-SSO to bind a simple AuthN \u0026amp; AuthZ mechanism.
Then, i\u0026rsquo;ll integrate with several Data Services.
After choosing whatever my application needs, i can either explore the file like Spring Initalizor or directly download the file to develop\u0026amp;run.
After launching the vscode i can develop and run my app on dev cluster. On the next posts, i\u0026rsquo;ll share more on development capabilities of TAP, for now, i\u0026rsquo;ll just deploy the workload.
$ kubectl apply -f config/tap Then, we\u0026rsquo;ll see that Secure Supply Chain is running step by step.
And, we\u0026rsquo;ll see that source code and image has been scanned part of pipeline. It also gives us what are the CVEs that are affecting the workload. Since this is just a demo, my scan policy is not stopping the pipeline because of the CVEs like Critical, High level.
And a result, we can see that app is deployed through the pipeline. s Also, we can see my k8s resources of that application and check pod logs etc from GUI.
On top of that, we can see the application\u0026rsquo;s architecture, like , what are the dependencies i have or what APIs do i have, etc.
After i access to endpoint of the application, i can see that TAP App-SSO is asking my credentials. After logging in, app is ready to use with data bindings.
Mongo Connection:
PostgreSQL Connection:
MySQL Connection:
Redis Connection:
Of course, there are a lot more to cover for TAP, we\u0026rsquo;ll continue on following posts.
`,url:"https://gorkemozlu.com/post/nodejs-on-tap/"},"https://gorkemozlu.com/post/":{title:"Posts",tags:[],content:"",url:"https://gorkemozlu.com/post/"},"https://gorkemozlu.com/post/operations-on-tce/":{title:"Operations on Tanzu Community Edition",tags:["Tanzu","TCE"],content:`On our last post we deployed Tanzu Community Edition with various ways. Today, we\u0026rsquo;ll cover more details like advantages of ClusterAPI and Tanzu packages.
As you can see below, cluster-001\u0026rsquo;s worker node is up cluster-001-md-0-7754fbbdb9-r5ttt and running for 59 minutes.
❯ docker ps --format \u0026#39;{{.Names}},{{.RunningFor}},{{.ID}}\u0026#39; cluster-001-md-0-7754fbbdb9-r5ttt,59 minutes ago,8593f398309f cluster-001-control-plane-zk8ck,About an hour ago,e53bc1e99a37 cluster-001-lb,About an hour ago,3cc0f58783e8 mgt-cluster-md-0-67d55c7fcd-nzvzq,About an hour ago,588e6ea02b58 mgt-cluster-control-plane-dbpk2,About an hour ago,47887bd30f1f mgt-cluster-lb,About an hour ago,dc7595716e26 Now, we\u0026rsquo;re going to terminate that worker node.
❯ docker stop 8593f398309f 8593f398309f ❯ docker rm 8593f398309f 8593f398309f ❯ docker ps --format \u0026#39;{{.Names}},{{.RunningFor}},{{.ID}}\u0026#39; cluster-001-control-plane-zk8ck,About an hour ago,e53bc1e99a37 cluster-001-lb,About an hour ago,3cc0f58783e8 mgt-cluster-md-0-67d55c7fcd-nzvzq,About an hour ago,588e6ea02b58 mgt-cluster-control-plane-dbpk2,About an hour ago,47887bd30f1f mgt-cluster-lb,About an hour ago,dc7595716e26 Then ClusterAPI will detect worker node is missing and will start to reconcile missing node.
capi-system capi-controller-manager-778bd4dfb9-qvl4s manager E1029 15:38:58.523247 1 machine_controller.go:685] controllers/Machine \u0026#34;msg\u0026#34;=\u0026#34;Unable to retrieve machine from node\u0026#34; \u0026#34;error\u0026#34;=\u0026#34;no matching Machine\u0026#34; \u0026#34;node\u0026#34;=\u0026#34;cluster-001-md-0-7754fbbdb9-r5ttt\u0026#34; capi-system capi-controller-manager-778bd4dfb9-qvl4s manager E1029 15:38:58.523713 1 machinehealthcheck_controller.go:480] controllers/MachineHealthCheck \u0026#34;msg\u0026#34;=\u0026#34;Unable to retrieve machine from node\u0026#34; \u0026#34;error\u0026#34;=\u0026#34;expecting one machine for node cluster-001-md-0-7754fbbdb9-r5ttt, got []\u0026#34; \u0026#34;node\u0026#34;=\u0026#34;cluster-001-md-0-7754fbbdb9-r5ttt\u0026#34; capi-system capi-controller-manager-778bd4dfb9-qvl4s manager I1029 15:39:03.015782 1 machinehealthcheck_controller.go:109] controllers/MachineHealthCheck \u0026#34;msg\u0026#34;=\u0026#34;Reconciling\u0026#34; \u0026#34;machinehealthcheck\u0026#34;=\u0026#34;cluster-001\u0026#34; \u0026#34;namespace\u0026#34;=\u0026#34;default\u0026#34; After couple minutes later, we\u0026rsquo;ll be able to see a new node is placed and ready.
❯ docker ps --format \u0026#39;{{.Names}},{{.RunningFor}},{{.ID}}\u0026#39; cluster-001-md-0-7754fbbdb9-8lsx5,2 minutes ago,34e1f3fd6976 cluster-001-control-plane-zk8ck,About an hour ago,e53bc1e99a37 cluster-001-lb,About an hour ago,3cc0f58783e8 mgt-cluster-md-0-67d55c7fcd-nzvzq,About an hour ago,588e6ea02b58 mgt-cluster-control-plane-dbpk2,2 hours ago,47887bd30f1f mgt-cluster-lb,2 hours ago,dc7595716e26 ❯ kubectl get nodes NAME STATUS ROLES AGE VERSION cluster-001-control-plane-zk8ck Ready control-plane,master 70m v1.21.2+vmware.1-360497810732255795 cluster-001-md-0-7754fbbdb9-8lsx5 Ready \u0026lt;none\u0026gt; 4m41s v1.21.2+vmware.1-360497810732255795 Tanzu Community Edition provides a simple way to deploy additional Packages to the Kubernetes Cluster.
There is a well-maintained repository that makes several components available.
❯ tanzu package repository add tce-repo \\ --url projects.registry.vmware.com/tce/main:0.9.1 \\ --namespace tanzu-package-repo-global ❯ tanzu package repository list --namespace tanzu-package-repo-global / Retrieving repositories... NAME REPOSITORY STATUS DETAILS tce-repo projects.registry.vmware.com/tce/main:0.9.1 Reconcile succeeded ❯ tanzu package available list / Retrieving available packages... NAME DISPLAY-NAME SHORT-DESCRIPTION cert-manager.community.tanzu.vmware.com cert-manager Certificate management contour.community.tanzu.vmware.com Contour An ingress controller external-dns.community.tanzu.vmware.com external-dns This package provides DNS synchronization functionality. fluent-bit.community.tanzu.vmware.com fluent-bit Fluent Bit is a fast Log Processor and Forwarder gatekeeper.community.tanzu.vmware.com gatekeeper policy management grafana.community.tanzu.vmware.com grafana Visualization and analytics software harbor.community.tanzu.vmware.com Harbor OCI Registry knative-serving.community.tanzu.vmware.com knative-serving Knative Serving builds on Kubernetes to support deploying and serving of applications and functions as serverless containers local-path-storage.community.tanzu.vmware.com local-path-storage This package provides local path node storage and primarily supports RWO AccessMode. multus-cni.community.tanzu.vmware.com multus-cni This package provides the ability for enabling attaching multiple network interfaces to pods in Kubernetes prometheus.community.tanzu.vmware.com prometheus A time series database for your metrics velero.community.tanzu.vmware.com velero Disaster recovery capabilities Even we can deploy storageClass as an application/package.
kubectl get sc No resources found ❯ tanzu package available list local-path-storage.community.tanzu.vmware.com / Retrieving package versions for local-path-storage.community.tanzu.vmware.com... NAME VERSION RELEASED-AT local-path-storage.community.tanzu.vmware.com 0.0.19 2021-09-15T00:00:00Z local-path-storage.community.tanzu.vmware.com 0.0.20 2021-09-15T00:00:00Z ❯ tanzu package install local-path-storage --package-name local-path-storage.community.tanzu.vmware.com --version 0.0.20 / Installing package \u0026#39;local-path-storage.community.tanzu.vmware.com\u0026#39; | Getting namespace \u0026#39;default\u0026#39; | Getting package metadata for \u0026#39;local-path-storage.community.tanzu.vmware.com\u0026#39; | Creating service account \u0026#39;local-path-storage-default-sa\u0026#39; | Creating cluster admin role \u0026#39;local-path-storage-default-cluster-role\u0026#39; | Creating cluster role binding \u0026#39;local-path-storage-default-cluster-rolebinding\u0026#39; - Creating package resource - Package install status: Reconciling Added installed package \u0026#39;local-path-storage\u0026#39; in namespace \u0026#39;default\u0026#39; ❯ kubectl get sc NAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGE local-path (default) rancher.io/local-path Delete WaitForFirstConsumer false 19s It\u0026rsquo;s possible to modify an application\u0026rsquo;s default configuration.
❯ cat \u0026lt;\u0026lt;EOF \u0026gt; prom.yaml prometheus: pvc: storageClassName: local-path storage: 1Gi EOF ❯ tanzu package available list prometheus.community.tanzu.vmware.com / Retrieving package versions for prometheus.community.tanzu.vmware.com... NAME VERSION RELEASED-AT prometheus.community.tanzu.vmware.com 2.27.0 2021-05-12T18:00:00Z ❯ tanzu package install prometheus --package-name prometheus.community.tanzu.vmware.com --version 2.27.0 -f prom.yaml / Installing package \u0026#39;prometheus.community.tanzu.vmware.com\u0026#39; | Getting namespace \u0026#39;default\u0026#39; | Getting package metadata for \u0026#39;prometheus.community.tanzu.vmware.com\u0026#39; | Creating service account \u0026#39;prometheus-default-sa\u0026#39; | Creating cluster admin role \u0026#39;prometheus-default-cluster-role\u0026#39; | Creating cluster role binding \u0026#39;prometheus-default-cluster-rolebinding\u0026#39; | Creating secret \u0026#39;prometheus-default-values\u0026#39; - Creating package resource / Package install status: Reconciling Added installed package \u0026#39;prometheus\u0026#39; in namespace \u0026#39;default\u0026#39; ❯ kubectl get pods,svc -n prometheus NAME READY STATUS RESTARTS AGE pod/alertmanager-6877f5989c-2stqd 1/1 Running 0 2m49s pod/prometheus-cadvisor-8q6kl 1/1 Running 0 2m50s pod/prometheus-kube-state-metrics-7db8755b58-hzqsd 1/1 Running 0 2m49s pod/prometheus-node-exporter-fvfjh 1/1 Running 0 2m49s pod/prometheus-node-exporter-krt97 1/1 Running 0 2m49s pod/prometheus-pushgateway-d46f4f587-592qw 1/1 Running 0 2m49s pod/prometheus-server-657c5594df-4ggss 2/2 Running 0 2m49s NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE service/alertmanager ClusterIP 100.69.3.87 \u0026lt;none\u0026gt; 80/TCP 2m50s service/prometheus-kube-state-metrics ClusterIP None \u0026lt;none\u0026gt; 80/TCP,81/TCP 2m50s service/prometheus-node-exporter ClusterIP 100.64.148.41 \u0026lt;none\u0026gt; 9100/TCP 2m49s service/prometheus-pushgateway ClusterIP 100.71.241.176 \u0026lt;none\u0026gt; 9091/TCP 2m50s service/prometheus-server ClusterIP 100.69.133.10 \u0026lt;none\u0026gt; 80/TCP 2m49s `,url:"https://gorkemozlu.com/post/operations-on-tce/"},"https://gorkemozlu.com/post/getting-started-with-tce/":{title:"Getting Started with Tanzu Community Edition",tags:["Tanzu","TCE"],content:`Tanzu Community Edition is a full-featured, easy-to-manage Kubernetes platform for learners and users, especially those working in small-scale or preproduction environments.
VMware Tanzu Community Edition is a full-featured, easy to manage Kubernetes platform for learners and users. It is a freely available, community supported, open source distribution of VMware Tanzu that can be installed and configured in minutes on your local workstation or your favorite cloud.
It includes a package repository for installing and updating components of your platform.
Within Tanzu Community edition, there are two methods to building Kubernetes centric platforms.
Management + Workload Clusters : This method involves provisioning a management Kubernetes Cluster and using that cluster to build more Kubernetes workload Clusters. The management cluster helps in providing/storing authentication details of workload clusters via Cluster API. Standalone Clusters : These are Kubernetes clusters built without a management cluster directly on the infrastructure provide of choice. Once the Standalone Cluster is built, storing and retrieving access to the Kubernetes cluster is deferred to the admin of the cluster. You can get the latest release from the github page
Standalone Cluster Once you download and extract the package you can follow below lines to create a simple standalone cluster.
./install.sh tanzu standalone-cluster create --ui For local quick development purposes, choose docker and give cluster a name, you can leave the default network configuration alone.
You can either hit the deploy button or use CLI command instead.
Once it finishes, you cluster is ready and you can go ahead and execute the tanzu or kubectl commands.
❯ kubectl get nodes NAME STATUS ROLES AGE VERSION cluster01-control-plane-mf97d Ready control-plane,master 7m28s v1.21.2+vmware.1-360497810732255795 cluster01-md-0-5cccffd8d4-8gw69 Ready \u0026lt;none\u0026gt; 7m2s v1.21.2+vmware.1-360497810732255795 ❯ kubectl get ns NAME STATUS AGE default Active 7m54s kube-node-lease Active 7m55s kube-public Active 7m55s kube-system Active 7m55s tanzu-package-repo-global Active 7m22s tkg-system Active 7m30s tkg-system-public Active 7m42s tkr-system Active 7m42s You can delete your standalone cluster via below command.
❯ tanzu standalone-cluster delete cluster01 Loading bootstrap cluster config for standalone cluster at \u0026#39;/Users/gorkem/.config/tanzu/tkg/clusterconfigs/cluster01.yaml\u0026#39; Deleting standalone cluster \u0026#39;cluster01\u0026#39;. Are you sure? [y/N]: y loading cluster config file at /Users/gorkem/.config/tanzu/tkg/clusterconfigs/cluster01.yaml Setting up cleanup cluster... Installing providers to cleanup cluster... Moving all Cluster API objects from bootstrap cluster to standalone cluster... Waiting for the Cluster API objects to be ready after restore ... Deleting standalone cluster... Standalone cluster \u0026#39;cluster01\u0026#39; deleted. Deleting the standalone cluster context from the kubeconfig file \u0026#39;/Users/gorkem/.kube/config\u0026#39; warning: this removed your active context, use \u0026#34;kubectl config use-context\u0026#34; to select a different one Standalone cluster deleted! Removing temporary bootstrap cluster config for standalone cluster at \u0026#39;/Users/gorkem/.config/tanzu/tkg/configs/cluster01_ClusterConfig\u0026#39; no bootstrap cluster config found - skipping Removing temporary UI bootstrap cluster config for standalone cluster at \u0026#39;/Users/gorkem/.config/tanzu/clusterconfigs/cluster01.yaml\u0026#39; no UI bootstrap cluster config found - skipping Management Cluster As mentioned before management cluster provides a control plane layer for keeping regular clusters at desired state.
You can follow below commands to deployment management cluster.
tanzu management-cluster create --ui For local quick development purposes, choose docker and give the management cluster a name, you can leave the default network configuration alone.
Since we deploy the management cluster, we can use tanzu and kubectl commands.
❯ tanzu management-cluster get NAME NAMESPACE STATUS CONTROLPLANE WORKERS KUBERNETES ROLES mgt-cluster tkg-system running 1/1 1/1 v1.21.2+vmware.1 management Details: NAME READY SEVERITY REASON SINCE MESSAGE /mgt-cluster True 12m ├─ClusterInfrastructure - DockerCluster/mgt-cluster True 12m ├─ControlPlane - KubeadmControlPlane/mgt-cluster-control-plane True 12m │ └─Machine/mgt-cluster-control-plane-dbpk2 True 12m └─Workers └─MachineDeployment/mgt-cluster-md-0 └─Machine/mgt-cluster-md-0-67d55c7fcd-nzvzq True 12m Providers: NAMESPACE NAME TYPE PROVIDERNAME VERSION WATCHNAMESPACE capd-system infrastructure-docker InfrastructureProvider docker v0.3.23 capi-kubeadm-bootstrap-system bootstrap-kubeadm BootstrapProvider kubeadm v0.3.23 capi-kubeadm-control-plane-system control-plane-kubeadm ControlPlaneProvider kubeadm v0.3.23 capi-system cluster-api CoreProvider cluster-api v0.3.23 ❯ tanzu management-cluster kubeconfig get mgt-cluster --admin Credentials of cluster \u0026#39;mgt-cluster\u0026#39; have been saved You can now access the cluster by running \u0026#39;kubectl config use-context mgt-cluster-admin@mgt-cluster\u0026#39; ❯ kubectl config use-context mgt-cluster-admin@mgt-cluster Switched to context \u0026#34;mgt-cluster-admin@mgt-cluster\u0026#34;. ❯ kubectl get nodes NAME STATUS ROLES AGE VERSION mgt-cluster-control-plane-dbpk2 Ready control-plane,master 18m v1.21.2+vmware.1-360497810732255795 mgt-cluster-md-0-67d55c7fcd-nzvzq Ready \u0026lt;none\u0026gt; 17m v1.21.2+vmware.1-360497810732255795 We\u0026rsquo;ll deploy a cluster via management cluster. Cluster API will handle the provisioning and storing the authentication details.
❯ tanzu cluster create cluster-001 --plan dev Workload cluster \u0026#39;cluster-001\u0026#39; created ❯ tanzu cluster kubeconfig get cluster-001 --admin Credentials of cluster \u0026#39;cluster-001\u0026#39; have been saved You can now access the cluster by running \u0026#39;kubectl config use-context cluster-001-admin@cluster-001\u0026#39; ❯ kubectl config use-context cluster-001-admin@cluster-001 Switched to context \u0026#34;cluster-001-admin@cluster-001\u0026#34;. ❯ kubectl get nodes NAME STATUS ROLES AGE VERSION cluster-001-control-plane-zk8ck Ready control-plane,master 8m5s v1.21.2+vmware.1-360497810732255795 cluster-001-md-0-7754fbbdb9-r5ttt Ready \u0026lt;none\u0026gt; 7m34s v1.21.2+vmware.1-360497810732255795 ❯ docker ps --format \u0026#39;{{.Names}},{{.RunningFor}}\u0026#39; cluster-001-md-0-7754fbbdb9-r5ttt,12 minutes ago cluster-001-control-plane-zk8ck,13 minutes ago cluster-001-lb,13 minutes ago mgt-cluster-md-0-67d55c7fcd-nzvzq,33 minutes ago mgt-cluster-control-plane-dbpk2,34 minutes ago mgt-cluster-lb,34 minutes ago We\u0026rsquo;ll cover more details on next post.
`,url:"https://gorkemozlu.com/post/getting-started-with-tce/"},"https://gorkemozlu.com/post/updating-images-with-kpack/":{title:"Updating images with kpack",tags:["kpack","build","development"],content:"Last time we built an image with kpack. This time we\u0026rsquo;ll be updating the image without hassle.\nEarlier logs shows that revision 82cb521d636b282340378d80a6307a08e3d4a4c4 checked-out when we applied the yaml.\nstern pet + petclinic-image-build-1-build-pod › prepare petclinic-image-build-1-build-pod prepare Build reason(s): CONFIG petclinic-image-build-1-build-pod prepare CONFIG: petclinic-image-build-1-build-pod prepare resources: {} petclinic-image-build-1-build-pod prepare - source: {} petclinic-image-build-1-build-pod prepare + source: petclinic-image-build-1-build-pod prepare + git: petclinic-image-build-1-build-pod prepare + revision: 82cb521d636b282340378d80a6307a08e3d4a4c4 petclinic-image-build-1-build-pod prepare + url: https://github.com/spring-projects/spring-petclinic petclinic-image-build-1-build-pod prepare Loading secrets for \u0026#34;https://index.docker.io/v1/\u0026#34; from secret \u0026#34;dockerhub-registry-credentials\u0026#34; petclinic-image-build-1-build-pod prepare Cloning \u0026#34;https://github.com/spring-projects/spring-petclinic\u0026#34; @ \u0026#34;82cb521d636b282340378d80a6307a08e3d4a4c4\u0026#34;... petclinic-image-build-1-build-pod prepare Successfully cloned \u0026#34;https://github.com/spring-projects/spring-petclinic\u0026#34; @ \u0026#34;82cb521d636b282340378d80a6307a08e3d4a4c4\u0026#34; in path \u0026#34;/workspace\u0026#34; Step 1. Update rev-id in yaml Now, we\u0026rsquo;re going to update the image yaml with an another revision.\n$ sed \u0026#39;s/82cb521d636b282340378d80a6307a08e3d4a4c4/01621077cbf76aa873eab64f0f0f50aaf6a04b90/g\u0026#39; \u0026#39;image.yaml\u0026#39; apiVersion: kpack.io/v1alpha1 kind: Image metadata: name: petclinic-image namespace: default spec: tag: index.docker.io/bgorkemozlu/public serviceAccount: dockerhub-service-account builder: name: my-builder kind: Builder source: git: url: https://github.com/spring-projects/spring-petclinic revision: 01621077cbf76aa873eab64f0f0f50aaf6a04b90 Step 2. Update image build $ kubectl apply -f image.yaml image.kpack.io/petclinic-image configured Now, we see a new build pod show up.\n$ kubectl get pods NAME READY STATUS RESTARTS AGE kpack-demo-5698f7dd84-7rxrv 1/1 Running 0 15m petclinic-image-build-1-build-pod 0/1 Completed 0 55m petclinic-image-build-2-build-pod 0/1 Init:0/6 0 21s It also says new revision has picked up.\nstern -n default petclinic-image-build-2-build-pod + petclinic-image-build-2-build-pod › prepare petclinic-image-build-2-build-pod prepare Build reason(s): COMMIT petclinic-image-build-2-build-pod prepare COMMIT: petclinic-image-build-2-build-pod prepare - 82cb521d636b282340378d80a6307a08e3d4a4c4 petclinic-image-build-2-build-pod prepare + 01621077cbf76aa873eab64f0f0f50aaf6a04b90 petclinic-image-build-2-build-pod prepare Loading secrets for \u0026#34;https://index.docker.io/v1/\u0026#34; from secret \u0026#34;dockerhub-registry-credentials\u0026#34; petclinic-image-build-2-build-pod prepare Cloning \u0026#34;https://github.com/spring-projects/spring-petclinic\u0026#34; @ \u0026#34;01621077cbf76aa873eab64f0f0f50aaf6a04b90\u0026#34;... Step 3. Check updated image $ kubectl get images NAME LATESTIMAGE READY petclinic-image index.docker.io/bgorkemozlu/public@sha256:4d11e0180343ba1a76624028c3f16941b5671d35295f742e48bff18a5628057b True Step 4. Deploy the updated image $ kubectl patch deployment kpack-demo -p \\ \u0026#39;{\u0026#34;spec\u0026#34;:{\u0026#34;template\u0026#34;:{\u0026#34;spec\u0026#34;:{\u0026#34;containers\u0026#34;:[{\u0026#34;name\u0026#34;:\u0026#34;public\u0026#34;,\u0026#34;image\u0026#34;:\u0026#34;index.docker.io/bgorkemozlu/public@sha256:4d11e0180343ba1a76624028c3f16941b5671d35295f742e48bff18a5628057b\u0026#34;}]}}}}\u0026#39; deployment.apps/kpack-demo patched $ kubectl expose deployment kpack-demo --port=8080 service/kpack-demo exposed $ kubectl port-forward svc/kpack-demo 8080:8080 ",url:"https://gorkemozlu.com/post/updating-images-with-kpack/"},"https://gorkemozlu.com/post/getting-started-with-kpack/":{title:"Getting Started with kpack",tags:["kpack","build","development"],content:"kpack is a K8s-native Way to Build and Update Containers.\nPrep. Prepare a conformant kubernetes cluster. Deploy kpack first. Then, optionally install stern\nkubectl apply -f https://github.com/pivotal/kpack/releases/download/v0.4.0/release-0.4.0.yaml Step 1. $ kubectl apply -f secret.yaml apiVersion: v1 kind: Secret metadata: name: dockerhub-registry-credentials annotations: kpack.io/docker: https://index.docker.io/v1/ type: kubernetes.io/basic-auth stringData: username: \u0026#34;username\u0026#34; password: \u0026#34;password\u0026#34; Step 2. $ kubectl apply -f sa.yaml apiVersion: v1 kind: ServiceAccount metadata: name: dockerhub-service-account secrets: - name: dockerhub-registry-credentials imagePullSecrets: - name: dockerhub-registry-credentials Step 3. ClusterStore $ kubectl apply -f clusterstore.yaml apiVersion: kpack.io/v1alpha1 kind: ClusterStore metadata: name: default spec: sources: - image: gcr.io/paketo-buildpacks/java Step 4. ClusterStack $ kubectl apply -f clusterstack.yaml apiVersion: kpack.io/v1alpha1 kind: ClusterStack metadata: name: base spec: id: \u0026#34;io.buildpacks.stacks.bionic\u0026#34; buildImage: image: \u0026#34;paketobuildpacks/build:base-cnb\u0026#34; runImage: image: \u0026#34;paketobuildpacks/run:base-cnb\u0026#34; Step 4. Builder $ kubectl apply -f builder.yaml apiVersion: kpack.io/v1alpha1 kind: Builder metadata: name: my-builder namespace: default spec: serviceAccount: dockerhub-service-account tag: index.docker.io/bgorkemozlu/builder stack: name: base kind: ClusterStack store: name: default kind: ClusterStore order: - group: - id: paketo-buildpacks/java Step 4. Image $ kubectl apply -f image.yaml apiVersion: kpack.io/v1alpha1 kind: Image metadata: name: petclinic-image namespace: default spec: tag: index.docker.io/bgorkemozlu/public serviceAccount: dockerhub-service-account builder: name: my-builder kind: Builder source: git: url: https://github.com/spring-projects/spring-petclinic revision: 82cb521d636b282340378d80a6307a08e3d4a4c4 $ kubectl get images NAME LATESTIMAGE READY petclinic-image Unknown $ kubectl get pods NAME READY STATUS RESTARTS AGE petclinic-image-build-1-build-pod 0/1 Init:0/6 0 15s $ stern -n default petclinic-image-build-1-build-pod $ kubectl get pods NAME READY STATUS RESTARTS AGE petclinic-image-build-1-build-pod 0/1 Completed 0 9m $ kubectl get images NAME LATESTIMAGE READY petclinic-image index.docker.io/bgorkemozlu/public@sha256:fadd73872877c763dce77b4df8f9b693323540657ba823fdd2eff329e9f120ab True $ kubectl create deployment kpack-demo --image=index.docker.io/bgorkemozlu/public@sha256:fadd73872877c763dce77b4df8f9b693323540657ba823fdd2eff329e9f120ab deployment.apps/kpack-demo created $ kubectl expose deployment kpack-demo --port=8080 service/kpack-demo exposed $ kubectl port-forward svc/kpack-demo 8080:8080 ",url:"https://gorkemozlu.com/post/getting-started-with-kpack/"}}</script><script src=/js/lunr.min.js></script>
<script src=/js/search.js></script><div class="widget-sidemenu widget"><h4 class=widget__title>Menu</h4><nav class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/about/>About</a></li><li class=widget__item><a class=widget__link href=/disclaimer/>Disclaimer</a></li></ul></nav></div><div class="widget-recent widget"><h4 class=widget__title>Recent Posts</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/post/nodejs-on-tap/>Developing and Deploying NodeJS with Data Services on TAP</a></li><li class=widget__item><a class=widget__link href=/post/operations-on-tce/>Operations on Tanzu Community Edition</a></li><li class=widget__item><a class=widget__link href=/post/getting-started-with-tce/>Getting Started with Tanzu Community Edition</a></li><li class=widget__item><a class=widget__link href=/post/updating-images-with-kpack/>Updating images with kpack</a></li><li class=widget__item><a class=widget__link href=/post/getting-started-with-kpack/>Getting Started with kpack</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>Categories</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/categories/build/>build</a></li><li class=widget__item><a class=widget__link href=/categories/data/>Data</a></li><li class=widget__item><a class=widget__link href=/categories/development/>development</a></li><li class=widget__item><a class=widget__link href=/categories/kpack/>kpack</a></li><li class=widget__item><a class=widget__link href=/categories/nodejs/>NodeJS</a></li><li class=widget__item><a class=widget__link href=/categories/tanzu/>Tanzu</a></li><li class=widget__item><a class=widget__link href=/categories/tap/>TAP</a></li><li class=widget__item><a class=widget__link href=/categories/tce/>TCE</a></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>Tags</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=/tags/build/ title=build>build</a>
<a class="widget-taglist__link widget__link btn" href=/tags/data/ title=Data>Data</a>
<a class="widget-taglist__link widget__link btn" href=/tags/development/ title=development>development</a>
<a class="widget-taglist__link widget__link btn" href=/tags/kpack/ title=kpack>kpack</a>
<a class="widget-taglist__link widget__link btn" href=/tags/mongodb/ title=MongoDB>MongoDB</a>
<a class="widget-taglist__link widget__link btn" href=/tags/mysql/ title=MySQL>MySQL</a>
<a class="widget-taglist__link widget__link btn" href=/tags/nodejs/ title=NodeJS>NodeJS</a>
<a class="widget-taglist__link widget__link btn" href=/tags/postgresql/ title=PostgreSQL>PostgreSQL</a>
<a class="widget-taglist__link widget__link btn" href=/tags/redis/ title=Redis>Redis</a>
<a class="widget-taglist__link widget__link btn" href=/tags/tanzu/ title=Tanzu>Tanzu</a>
<a class="widget-taglist__link widget__link btn" href=/tags/tap/ title=TAP>TAP</a>
<a class="widget-taglist__link widget__link btn" href=/tags/tce/ title=TCE>TCE</a></div></div><div class="widget-social widget"><h4 class="widget-social__title widget__title">Social</h4><div class="widget-social__content widget__content"><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=LinkedIn rel="noopener noreferrer" href=https://linkedin.com/in/bgorkemozlu target=_blank><svg class="widget-social__link-icon icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352"><path d="M0 40v272c0 21.9 18.1 40 40 40h272c21.9.0 40-18.1 40-40V40c0-21.9-18.1-40-40-40H40C18.1.0.0 18.1.0 40zm312-8c4.6.0 8 3.4 8 8v272c0 4.6-3.4 8-8 8H40c-4.6.0-8-3.4-8-8V40c0-4.6 3.4-8 8-8H312zM59.5 87c0 15.2 12.3 27.5 27.5 27.5s27.5-12.3 27.5-27.5S102.2 59.5 87 59.5 59.5 71.8 59.5 87zM187 157h-1v-21h-45v152h47v-75c0-19.8 3.9-39 28.5-39 24.2.0 24.5 22.4 24.5 40v74h47v-83.5c0-40.9-8.7-72-56.5-72-23 0-38.2 12.6-44.5 24.5zM64 288h47.5V136H64V288z"/></svg><span>LinkedIn</span></a></div><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=GitHub rel="noopener noreferrer" href=https://github.com/gorkemozlu target=_blank><svg class="widget-social__link-icon icon icon-github" width="24" height="24" viewBox="0 0 384 374"><path d="m192 0C85.9.0.0 85.8.0 191.7c0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2.0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8.0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7.0.0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4.0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5.0 25.6-.2 46.3-.2 52.6.0 5.1 3.5 11.1 13.2 9.2C329 348.2 384 276.4 384 191.7 384 85.8 298 0 192 0z"/></svg><span>GitHub</span></a></div></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__links><a class=footer__link href=/about/>About</a> | <a class=footer__link href=/disclaimer/>Disclaimer</a></div><div class=footer__copyright>&copy; 2022 Gorkem Ozlu - Yet Another Cloud Native Blog.
<span class=footer__copyright-credits></span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>